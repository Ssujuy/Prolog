:-lib(ic).
:-lib(branch_and_bound).


skyscr(Id, Solution) :-
       puzzle(Id, Max, Left, Right, Top, Bottom , Board),
       Solution = Board,
       Solution#:: 1..Max,
       left_skyscr(Left, Solution),
       search(Solution,0,input_order,indomain,complete,[]).


left_skyscr(Left, Solution) :-
       [Hl | Tl] = Left,
       [Hs | Ts] = Solution,
       Hl = 0,
       left_skyscr(Tl, Ts).

left_skyscr(Left, Solution) :-
       [Hl | Tl] = Left,
       [Hs | Ts] = Solution,
       Hl \= 0,
       length(Hs, Len),
       length(Visible, Len),
       Visible#:: 0..1,
       constrain_left_skyscr(Hs,Visible,0),
       find_sum(Visible,0,TotalSum),
       TotalSum#=Hl, 
       left_skyscr(Tl, Ts).

left_skyscr([],[]).


constrain_left_skyscr(L,Visible,0) :-
       [Hv | Tv] = Visible,
       [H | T] = L,
       Hv#=1,
       constrain_left_skyscr(T,Tv,H).

constrain_left_skyscr(L,Visible,MaxVar) :-
       MaxVar \= 0,
       [Hv | Tv] = Visible,
       [H | T] = L,
       H #> MaxVar,
       Hv#=1,
       constrain_left_skyscr(T,Tv,H).

constrain_left_skyscr(L,Visible,MaxVar) :-
       MaxVar \= 0,
       [Hv | Tv] = Visible,
       [H | T] = L,
       H #< MaxVar,
       Hv#=0,
       constrain_left_skyscr(T,Tv,MaxVar).

constrain_left_skyscr([],[],_).


find_sum(Visible,Sum,TotalSum) :-
    [H | T] = Visible,
    NSum #= Sum + H,
    find_sum(T,NSum,TotalSum).

find_sum([],TotalSum,TotalSum).




set_length(L,N) :-
       [H | T] = L,
       length(H,N),
       set_length(T,N).

set_length([],_).


puzzle(demo, 5,
       [0,2,0,2,4], [4,0,2,0,0],
       [0,0,0,0,0], [0,3,0,2,0],
       [[_,_,_,_,_],
        [_,_,_,_,_],
        [_,5,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,_]]).

puzzle(easy4x4, 4, 
       [3,2,1,3], [1,3,3,2],
       [3,2,2,1], [2,3,1,2],
       [[_,_,_,_],
        [_,_,_,_],
        [_,_,_,_],
        [_,_,_,_]]).

puzzle(normal4x4, 4, 
       [0,0,0,0], [3,0,2,0],
       [0,0,0,0], [0,0,1,2],
       [[_,_,_,_],
        [_,_,_,_],
        [_,_,_,_],
        [_,_,_,_]]).

puzzle(hard4x4, 4, 
       [0,2,2,0], [0,0,0,0],
       [0,0,0,0], [0,2,0,3],
       [[_,_,2,_],
        [_,_,_,_],
        [_,_,4,_],
        [_,_,_,_]]).

puzzle(easy5x5, 5, 
       [5,2,2,1,3], [1,4,2,4,2],
       [4,2,3,2,1], [2,3,1,3,2],
       [[_,_,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,_]]).

puzzle(normal5x5, 5, 
       [0,3,0,0,0], [0,0,0,0,4],
       [3,2,0,0,0], [0,0,0,5,3],
       [[_,_,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,_]]).

puzzle(hard5x5, 5, 
       [0,2,4,0,0], [0,0,0,3,0],
       [0,0,2,4,0], [0,3,0,0,0],
       [[_,_,_,2,_],
        [_,_,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,_],
        [_,_,_,_,1]]).

puzzle(easy6x6, 6, 
       [2,3,3,1,2,3], [1,2,2,4,3,2],
       [2,4,2,3,2,1], [2,2,2,1,3,3],
       [[_,_,_,_,4,_],
        [_,_,_,_,_,_],
        [_,_,_,_,_,5],
        [_,_,3,_,_,_],
        [_,_,_,3,_,_],
        [3,_,_,_,_,_]]).

puzzle(normal6x6, 6, 
       [0,4,0,3,0,0], [0,0,0,0,5,0],
       [3,1,0,3,0,4], [0,0,0,3,4,0],
       [[_,_,_,_,_,_],
        [_,_,_,_,_,_],
        [_,_,_,1,_,_],
        [_,_,_,_,_,_],
        [_,_,_,_,_,_],
        [_,_,2,_,_,_]]).

puzzle(hard6x6, 6, 
       [4,0,2,0,2,0], [0,3,2,3,0,0],
       [0,2,2,2,4,0], [0,0,0,4,0,3],
       [[_,_,_,_,_,_],
        [_,_,_,_,_,_],
        [_,_,_,_,_,_],
        [_,_,3,_,_,_],
        [_,_,_,_,_,_],
        [_,_,_,_,_,_]]).

puzzle(hard7x7, 7,
       [2,3,0,1,3,2,0], [0,2,0,0,0,0,3],
       [3,0,3,3,0,0,0], [0,0,2,0,3,0,0],
       [[_,1,_,_,_,_,_],
        [_,_,_,_,4,_,_],
        [_,5,_,_,_,_,_],
        [_,_,_,_,_,4,_],
        [_,_,_,_,_,_,_],
        [_,_,_,_,1,_,_],
        [_,_,_,5,_,_,_]]).

puzzle(hard8x8, 8,
       [3,0,4,2,0,3,3,0], [0,0,3,3,5,3,4,0],
       [2,0,0,5,3,0,0,0], [3,0,0,0,4,4,0,0],
       [[_,_,5,_,_,_,_,_],
        [_,4,3,_,_,_,2,_],
        [_,_,_,_,_,_,_,1],
        [_,_,_,_,_,_,_,_],
        [_,_,_,_,_,5,_,2],
        [_,_,_,8,_,_,_,_],
        [_,6,_,_,_,1,4,_],
        [_,_,_,_,_,_,_,_]]).

puzzle(hard9x9, 9,
       [0,0,0,0,1,5,3,0,3], [0,3,3,2,3,0,0,5,0],
       [2,3,0,0,3,4,2,0,3], [3,0,6,4,3,0,2,2,4],
       [[_,_,_,_,_,_,_,_,_],
        [_,1,_,_,_,_,3,_,_],
        [_,_,_,_,1,2,_,_,5],
        [_,_,_,4,2,6,_,_,_],
        [_,_,_,_,_,_,_,1,_],
        [_,_,7,_,_,8,_,_,_],
        [_,_,_,_,_,_,_,3,_],
        [4,_,_,_,_,_,_,_,2],
        [_,_,_,_,_,9,_,_,_]]).